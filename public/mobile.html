<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KARAOCHAOS AUDIENCE</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #050505; color: white; font-family: sans-serif; text-align: center; text-transform: uppercase; margin: 0; padding: 20px; overflow-x: hidden; }
        
        h2 { color: #00f2ff; letter-spacing: 2px; }

        /* CIRCULAR TIMER STYLES */
        .mobile-timer-container {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .timer-svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(-90deg);
        }
        .timer-bg { fill: none; stroke: #222; stroke-width: 8; }
        #mobile-timer-bar {
            fill: none; 
            stroke: #ff00ff; /* Neon Pink for Mobile */
            stroke-width: 8; 
            stroke-linecap: round;
            stroke-dasharray: 283; 
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear;
        }
        #mobile-timer { font-size: 5rem; font-weight: bold; color: #ff00ff; position: relative; z-index: 10; }

        /* BUTTONS */
        .btn-vote { 
            background: #39ff14; 
            color: black; 
            border: none; 
            padding: 30px; 
            font-size: 1.8rem; 
            border-radius: 20px; 
            font-weight: bold; 
            width: 100%; 
            margin-top: 10px; 
            box-shadow: 0 0 20px #39ff14; 
            cursor: pointer;
        }
        
        .hidden { display: none !important; }
        #confirm { color: #39ff14; font-weight: bold; font-size: 1.5rem; margin-top: 20px; }
        
        #waiting-screen p { color: #aaa; margin-top: 50px; font-style: italic; }
    </style>
</head>
<body>
    <div id="waiting-screen">
        <h2 style="margin-top: 40px;">KARAOCHAOS</h2>
        <p>Waiting for the performer to finish...</p>
    </div>

    <div id="voting-screen" class="hidden">
        <h2>VOTE NOW!</h2>
        
        <div class="mobile-timer-container">
            <svg class="timer-svg" viewBox="0 0 100 100">
                <circle class="timer-bg" cx="50" cy="50" r="45"></circle>
                <circle id="mobile-timer-bar" cx="50" cy="50" r="45"></circle>
            </svg>
            <div id="mobile-timer">25</div>
        </div>

        <button id="vote-btn" class="btn-vote" onclick="sendVote()">THEY ARE KILLING IT!</button>
        <p id="confirm" class="hidden">VOTE CAST!</p>
    </div>

    <script>
        const socket = io(); 

        function sendVote() { 
            socket.emit('cast-vote'); 
            document.getElementById('vote-btn').classList.add('hidden'); 
            document.getElementById('confirm').classList.remove('hidden'); 
        }

        function enterVotingMode() { 
            document.getElementById('waiting-screen').classList.add('hidden'); 
            document.getElementById('voting-screen').classList.remove('hidden'); 
            document.getElementById('vote-btn').classList.remove('hidden'); 
            document.getElementById('confirm').classList.add('hidden'); 
        }

        socket.on('start-voting', () => {
            enterVotingMode();
        });

        socket.on('timer-update', (t) => { 
            // If the user joined late, force them into voting mode
            if(document.getElementById('voting-screen').classList.contains('hidden')) {
                enterVotingMode();
            }

            // Update the digital number
            document.getElementById('mobile-timer').innerText = t; 

            // Update the SVG Ring
            const circle = document.getElementById('mobile-timer-bar');
            const circumference = 283; // 2 * PI * 45
            const offset = circumference - (t / 25) * circumference;
            circle.style.strokeDashoffset = offset;
        });

        socket.on('voting-end', () => { 
            document.getElementById('waiting-screen').classList.remove('hidden'); 
            document.getElementById('voting-screen').classList.add('hidden'); 
        });
    </script>
</body>
</html>