<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KARAOCHAOS AUDIENCE</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #050505; color: white; font-family: sans-serif; text-align: center; text-transform: uppercase; margin: 0; padding: 20px; }
        .timer-container { position: relative; width: 220px; height: 220px; margin: 30px auto; display: flex; align-items: center; justify-content: center; }
        .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
        #mobile-timer-bar { fill: none; stroke: #ff00ff; stroke-width: 8; stroke-linecap: round; stroke-dasharray: 283; stroke-dashoffset: 0; transition: stroke-dashoffset 1s linear; }
        #mobile-timer { font-size: 5rem; font-weight: bold; color: #ff00ff; position: relative; z-index: 10; }
        .btn-vote { background: #39ff14; color: black; border: none; padding: 30px; font-size: 1.8rem; border-radius: 20px; font-weight: bold; width: 100%; box-shadow: 0 0 20px #39ff14; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="waiting-screen"><h2>KARAOCHAOS</h2><p style="color:#666; margin-top:50px;">Waiting for performer...</p></div>
    <div id="voting-screen" class="hidden">
        <h2>VOTE NOW!</h2>
        <div class="timer-container">
            <svg class="timer-svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="#222" stroke-width="8"></circle><circle id="mobile-timer-bar" cx="50" cy="50" r="45"></circle></svg>
            <div id="mobile-timer">25</div>
        </div>
        <button id="vote-btn" class="btn-vote" onclick="sendVote()">THEY ARE KILLING IT!</button>
        <p id="confirm" class="hidden" style="color:#39ff14; margin-top:20px; font-weight:bold;">VOTE CAST!</p>
    </div>
    <script>
        const socket = io(); 
        let myID = localStorage.getItem('voterFingerprint') || 'voter-' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('voterFingerprint', myID);

        function sendVote() { 
            if (localStorage.getItem('hasVoted') === 'true') return;
            socket.emit('cast-vote', myID); 
            localStorage.setItem('hasVoted', 'true');
            document.getElementById('vote-btn').classList.add('hidden'); 
            document.getElementById('confirm').classList.remove('hidden'); 
        }

        function enterVotingMode() { 
            document.getElementById('waiting-screen').classList.add('hidden'); 
            document.getElementById('voting-screen').classList.remove('hidden'); 
            const voted = localStorage.getItem('hasVoted') === 'true';
            document.getElementById('vote-btn').classList.toggle('hidden', voted);
            document.getElementById('confirm').classList.toggle('hidden', !voted);
        }

        socket.on('start-voting', () => { localStorage.removeItem('hasVoted'); enterVotingMode(); });
        socket.on('timer-update', (t) => { 
            if(document.getElementById('voting-screen').classList.contains('hidden')) enterVotingMode();
            document.getElementById('mobile-timer').innerText = t; 
            document.getElementById('mobile-timer-bar').style.strokeDashoffset = 283 - (t/25)*283;
        });
        socket.on('voting-end', () => { 
            localStorage.removeItem('hasVoted');
            document.getElementById('waiting-screen').classList.remove('hidden'); 
            document.getElementById('voting-screen').classList.add('hidden'); 
        });
    </script>
</body>
</html>